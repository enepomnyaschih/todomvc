var TodoMVC={ENTER_KEY:13,ESC_KEY:27};(function(){TodoMVC.App=function(a){TodoMVC.App._super.call(this);this.data=a};JW.extend(TodoMVC.App,JW.UI.Component,{renderInput:function(a){a.keydown(JW.inScope(this._onInputKeyDown,this))},renderMain:function(a){this.own(new JW.UI.VisibleUpdater(a,this.data.todos.length))},renderToggleAll:function(a){var b=this.own(new JW.Functor([this.data.activeTodoCount],function(c){return c===0},this)).target;this.own(new JW.UI.PropUpdater(a,"checked",b));a.click(JW.inScope(function(){var c=a.prop("checked");this.data.todos.each(function(d){d.completed.set(c)},this)},this))},renderTodos:function(){return this.own(this.data.filteredTodos.createMapper({createItem:function(a){return new TodoMVC.Todo.View(this.data,a)},destroyItem:JW.destroy,scope:this})).target},renderFooter:function(){return this.own(new TodoMVC.Footer(this.data))},_onInputKeyDown:function(b){var a;if(b.which!==TodoMVC.ENTER_KEY){return}a=jQuery.trim(this.getElement("input").val());if(a===""){return}this.data.todos.add(new TodoMVC.Todo(a,false));this.getElement("input").val("")}})})();JW.UI.template(TodoMVC.App,{main:'<div><section id="todoapp"><header id="header"><h1>todos</h1><input jwid="input" id="new-todo" type="text" placeholder="What needs to be done?"></header><section jwid="main" id="main"><input jwid="toggle-all" id="toggle-all" type="checkbox"><label for="toggle-all">Mark all as complete</label><ul jwid="todos" id="todo-list"></ul></section><div jwid="footer"></div></section><footer id="info"><p>Double-click to edit a todo</p><p>Created by <a href="http://github.com/enepomnyaschih/jwidget/">Egor Nepomnyaschih</a></p><p>Part of <a href="http://todomvc.com">TodoMVC</a></p></footer></div>'});(function(){TodoMVC.App.Data=function(){var c,b,a;TodoMVC.App.Data._super.call(this);this.todos=this.own(new JW.ObservableArray()).ownItems();this.filter=this.own(new JW.Functor([JW.UI.hash],function(d){return TodoMVC.Filter.getItem(d)||TodoMVC.Filter.getItem("/")},this)).target;c=this.own(this.todos.createFilterer({filterItem:this.filter.func}));this.filteredTodos=c.target;this.own(new JW.Updater([this.filter],function(d){c.reconfigure({filterItem:d.func})},this));b=this.own(this.todos.createCounter({filterItem:function(d){return !d.completed.get()}}));this.activeTodoCount=b.target;a=this.own(this.todos.createCounter({filterItem:function(d){return d.completed.get()}}));this.completedTodoCount=a.target;this.own(this.todos.createMapper({createItem:function(d){var e=new JW.Class();e.own(d.title.changeEvent.bind(this.updateStorage,this));e.own(d.completed.changeEvent.bind(function(){c.refilterItem(d);b.recount();a.recount();this.updateStorage()},this));return e},destroyItem:JW.destroy,scope:this}));this.own(this.todos.changeEvent.bind(this.updateStorage,this));this._storageUpdateTimeout=this.own(new JW.Property()).ownValue()};JW.extend(TodoMVC.App.Data,JW.Class,{updateStorage:function(){this._storageUpdateTimeout.set(new JW.Timeout(function(){localStorage["todos-jwidget"]=JSON.stringify(this.todos.map(function(a){return{title:a.title.get(),completed:a.completed.get()}},this))},this))},loadFromStorage:function(){var a,b=localStorage["todos-jwidget"];this.todos.clear();if(!b){return}a=JSON.parse(b);this.todos.addAll(JW.Array.map(a,function(c){return new TodoMVC.Todo(c.title,c.completed)},this))}})})();(function(){TodoMVC.Filter=function(c,a,b){TodoMVC.Filter._super.call(this);this.hash=c;this.name=a;this.func=b};JW.extend(TodoMVC.Filter,JW.Class);JW.makeRegistry(TodoMVC.Filter,"hash");TodoMVC.Filter.registerItem(new TodoMVC.Filter("/","All",function(){return true}));TodoMVC.Filter.registerItem(new TodoMVC.Filter("/active","Active",function(a){return !a.completed.get()}));TodoMVC.Filter.registerItem(new TodoMVC.Filter("/completed","Completed",function(a){return a.completed.get()}))})();(function(){TodoMVC.Footer=function(a){TodoMVC.Footer._super.call(this);this.data=a};JW.extend(TodoMVC.Footer,JW.UI.Component,{renderRoot:function(a){this.own(new JW.UI.VisibleUpdater(a,this.data.todos.length))},renderFilters:function(){var b,c,a;b=this.own(JW.Array.$map(TodoMVC.Filter.itemArray,function(d){return new TodoMVC.Footer.Filter(d)},this)).ownItems();c=b.index(JW.byField("filter.hash"));a=this.own(new JW.Functor([this.data.filter],function(d){return c[d.hash]},this)).target;this.own(new JW.Switcher([a],{init:function(d){d.selected.set(true)},done:function(d){d.selected.set(false)},scope:this}));return b},renderCountActive:function(a){this.own(new JW.UI.TextUpdater(a,this.data.activeTodoCount))},renderPluralActive:function(b){var a=this.own(new JW.Functor([this.data.activeTodoCount],function(c){return(c===1)?"":"s"},this)).target;this.own(new JW.UI.TextUpdater(b,a))},renderClearCompleted:function(a){this.own(new JW.UI.VisibleUpdater(a,this.data.completedTodoCount));a.click(JW.inScope(function(){this.data.todos.performFilter(this.data.todos.filter(function(b){return !b.completed.get()},this))},this))},renderCountCompleted:function(a){this.own(new JW.UI.TextUpdater(a,this.data.completedTodoCount))}})})();JW.UI.template(TodoMVC.Footer,{main:'<footer id="footer"><span id="todo-count"><strong jwid="count-active"></strong> item<span jwid="plural-active"></span> left</span><ul jwid="filters" id="filters"></ul><button jwid="clear-completed" id="clear-completed">Clear completed (<span jwid="count-completed"></span>)</button></footer>'});(function(){TodoMVC.Footer.Filter=function(a){TodoMVC.Footer.Filter._super.call(this);this.filter=a;this.selected=this.own(new JW.Property(false))};JW.extend(TodoMVC.Footer.Filter,JW.UI.Component,{renderLink:function(a){a.text(this.filter.name);a.attr("href","#"+this.filter.hash);this.own(new JW.UI.ClassUpdater(a,"selected",this.selected))}})})();JW.UI.template(TodoMVC.Footer.Filter,{main:'<li><a jwid="link"></a></li>'});(function(){TodoMVC.Todo=function(b,a){TodoMVC.Todo._super.call(this);this.title=this.own(new JW.Property(b));this.completed=this.own(new JW.Property(a))};JW.extend(TodoMVC.Todo,JW.Class)})();(function(){TodoMVC.Todo.View=function(b,a){TodoMVC.Todo.View._super.call(this);this.data=b;this.todo=a};JW.extend(TodoMVC.Todo.View,JW.UI.Component,{renderRoot:function(a){this.own(new JW.UI.ClassUpdater(a,"completed",this.todo.completed))},renderCheckbox:function(a){this.own(new JW.UI.PropUpdater(a,"checked",this.todo.completed));this.own(new JW.UI.CheckedListener(a,this.todo.completed))},renderTitle:function(a){this.own(new JW.UI.TextUpdater(a,this.todo.title));a.dblclick(JW.inScope(this._beginEdit,this));a.mousedown(JW.UI.preventDefault)},renderDestroy:function(a){a.click(JW.inScope(function(){this.data.todos.removeItem(this.todo)},this))},renderEdit:function(a){a.blur(JW.inScope(this._endEdit,this));a.keydown(JW.inScope(this._onEditKeyDown,this))},_beginEdit:function(){this.el.addClass("editing");this.getElement("edit").val(this.todo.title.get()).select().focus()},_endEdit:function(){var a;if(!this.el.hasClass("editing")){return}this.el.removeClass("editing");a=jQuery.trim(this.getElement("edit").val());if(a!==""){this.todo.title.set(a)}else{this.data.todos.removeItem(this.todo)}},_onEditKeyDown:function(a){if(a.which===TodoMVC.ENTER_KEY){this._endEdit()}else{if(a.which===TodoMVC.ESC_KEY){this.el.removeClass("editing")}}}})})();JW.UI.template(TodoMVC.Todo.View,{main:'<li><div class="view"><input jwid="checkbox" class="toggle" type="checkbox"><label jwid="title"></label><button jwid="destroy" class="destroy"></button></div><input jwid="edit" class="edit"></li>'});var todoData,todoApp;jQuery(function(){todoData=new TodoMVC.App.Data();todoData.loadFromStorage();todoApp=new TodoMVC.App(todoData);todoApp.renderTo("body")});